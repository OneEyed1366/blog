---
title: "Пару слов про тесты"
description: "Немного мыслей по поводу тестов и всего, что с ними связано"
slug: "2022-10-07-thoughts-about-tests"
date: "2022-10-07T18:05:41+03:00"
draft: false
comments: false
socialShare: true
toc: true
series: ["thoughts", "web"]
tags: ["frontend", "qa", "JavaScript"]
# cover:
#   src: ./cover.jpeg
---

## Тесты есть? А если найду??

Рано или поздно каждый разраб слышит фразу: "Хороший код должен быть покрыт тестами".
И вроде бы все логично: чем сложнее приложение, тем сложнее контролировать все его нюансы и взаимосвязи.

Значит, нужно `научить` какого-то исполнителя в вакууме тестировать то, что ты (или не ты)
написал в своем СУПЕР-МЕГА-ПРИЛОЖЕНИИ-ЗА-ОВЕР-ДОХРЕНА-ДЕНЕГ-В-НАНОСЕКУНДУ!

Ниже бегло рассмотрим пару-тройку сходу пришедших на ум инструментов
(ибо разрабы, будучи людьми "прогрессивными" ---читать _ЛЕНИВЫМИ_--- уже придумали довольно
много инструментов, которые позволяют эту проблему решить.)

### Список (**Костылей, Карл. КОС-ТЫ-ЛЕЙ**) инструментов, навскидку

#### [Jest](https://jestjs.io/)

Являясь одним из самых популярных инструментов для тестирования, негласно считается
"королем" среди Enterprise-приложений (но это не точно)
Применяется как для _Unit_, так и для _Component_ тестирования.
Можно применять и для _Integration_ тестирования, но там уже немножко больно

(
Ловит въетнамские флэшбэки и вспоминает проекты, которые делали _E2E_ тесты на Jest'e...
**Автор ушел пить кофе и рефлексировать, что раньше код был чище, а трава -- зеленей**
)

Плюсы:

- Легче интергрируется с [React-testing-library](https://testing-library.com/docs/react-testing-library/intro/)
- Хорошая дока, которая позволит тебе в моменте посмотреть, где и что ты не туда запихал
- Jest - лапочка, который легко и непринужденно вливается в любой проект (Не то, что я. _ПЛАЧЕТ_)
- Довольно шустро крутит (твои планы на пятничный вечер) все, что ты в него запихаешь
- Имеет богатую экосистему плагинов и расширений практически\* под любой framework

Минусы:

- "Шаг влево\вправо - расстрел"
  (иногда банально настроить _pre-commit_ - целый квест со случайно выпадающими гачи-микс сценами)
- Е\*\*нутая логика итерации по массиву
- Залез в конфиги - пеняй на себя (особенно, если ты вообще не сечёшь, что и НАФИГА ты делаешь)

#### [Mocha](https://mochajs.org/) + [Chai](https://www.chaijs.com/)

"Бонни и Клайд" в мире тестирования Web SPA приложений.
Долго и упорно наступают на пятки "мастодонту" в лице Jest'а.

Применяются также для _Unit_, _Component_ & _Integration_ тестирования.

Большой плюс: _Integration_ тестирование легче масштабируется
(понятный большинству пример: сравните количество boilerplate'а у ванильного
[_Redux_](https://redux.js.org/)
&
[_MobX_](https://mobx.js.org/)

Плюсы:

- Вроде как легче интегрироваться с экосистемой Vue2
  (за 3 версию не скажу, ибо щупал, но поверхностно)
- Легче Jest'а, и имеет чуть более читабельный синтаксис
  (сугубо на вкус Автора)
- На удивление шустрые ребята, которые могут сэкономить вам 2-3 секунды суровой
  кодерской жизни ("Плюсовики" дружно одобряют)
- Также богатая экосистема позволяет превратить эту почти невинную парочку
  в адский комбайн, который будет тестировать всё, вся, и в первую очередь
  нервы вашего ПМ'а
  (
  когда его в 100500 раз вызовут на ковер с целью объяснить,
  нахрена вы потратили 2 спринта "на увеличение отказоустойчивости приложения",
  если пришел очередной `chaotic-джун` и уронил production
  )

Минусы:

- Angular? Не, не слышал \*^-^\*
- Подробная, но чутка переусложненная дока может вогнать в ступор,
  а сразу после в неистовейшее ЖЕЛАНИЕ пойти поиграть с Jest'ом
- При обвешивании плагинами, становятся тяжелее Jest'а
- Mocha без Chai, что Нацу без Хэппи. Жить можно, но грустно.
  (Да и, как-бы, НАФИГА?!)

#### [Cypress](https://docs.cypress.io/guides/overview/why-cypress#What-you-ll-learn)

"И вот, на 3 день!.."
Ладно-ладно, интригу нагнал, теперь можно и пояснить.

Плюсы:

- Одно слово: ДОКА. Почитай, ты все поймешь
- "Клёвый, модный, молодежный" инструмент, который хочет привнести в этот серый и скучный
  мир QA немножко удобства и магии ("Плюсовики" дружно сделали страшную морду).
- Почти безупречно подходит для большинства DEV QA сценариев
  (у матерых QA'щиков уже свой, потом и кровью выстраданный набор "костылей"),
  часто используется для _Component_, _Integration_ & _E2E_ тестирования.
- Из коробки (с какой-то бородатой версии) дает тебе красивый и, что важнее,
  ТЫКАТЕЛЬНЫЙ UI, которым просто пользоваться.
- Если ты (как и я) странный человек, который использует форки Chromium'а,
  то для таких "одаренных" тут также есть `Electron`, для прогона тестов внутри него.
  У-Удобно

Минусы:

- Тяжелый, перед первым запуском, по сути, требует установки отдельного Cypress приложения
- Тяжело вливается в _Unit_ тестирование (хотя может)
- В зависимости от framework'а, при _Component_ тестироовании можно не раз (и нифига не два)
  стабильно стрелять себе в колено. Не из дробовика, но все же
- Имеет свой, "Chai-подобный" синтаксис, что усложняет переезд на него (в случае необходимости)
- jQuery! Напугал? Это хорошо, ибо бывают сценарии, когда он НУЖОН.

## "Интересная штучка, но есть-ли у неё практическое применение?"

Итак, мы бегло посмотрели на "главных игроков" QA-рынка
(в моих бредовых фантазиях. Да-да, санитары уже выехали),
но раз инструменты - есть, потребность - есть, то почему все эти
[TDD](https://habr.com/ru/company/ruvds/blog/450316/),
[BDD](<https://ru.wikipedia.org/wiki/BDD_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)>)
и прочее еще не стали мейнстримом?

(Оффтоп: если стало - сорян, автор в танке и пошел выпить _йаду_. Дальше лучше не читать)

По моему опыту, проблема всегда плюс-минус одна: **ДОРОГО**.

### Почему дорого?

Потому что бизнес не очень любит кидаться в людей деньгами (ВНЕЗАПНО!),
и для него **оптимизация** - слово покруче, чем **библия** для верующего.

(Мой агностик идет разбирацца, где это я таких слов понабрался)

Если вкратце, то на момент 2K22 разрабы - это дорого, а содержать
команду разрабов - это вообще дофига дорого.
Scrum, Agile, и вот эту вот всю "движуху" не от хорошей жизни придумали.

Так а все-таки, почему именно **Дорого?**

Потому что писать тесты - долго.
Да, условный Cypress пытается решить эту проблему (в мире Frontend'a), но все равно -
бизнес каждый раз оказывается перед выбором:

- Сделать новую супер-пупер-свистящую фичу?
- Покрыть приложени тестами?

Догадайтесь, что выбирают чаще.

## Но ведь на дистанции все-равно ведь дешевле содержать с тестами, разве нет?

Ответ - **безусловно**, но:

- Если эти тесты писал тот, кто УМЕЕТ ПИСАТЬ ТЕСТЫ.
- Если у бизнеса есть на это ДЕНЬГИ

А теперь, давайте по пунктам:

### Что значит: уметь писать тесты?

- Тесты замедляют "ржавение" кода
- Тесты тестируют то, что НАДО тестировать
- Тесты частично снимают с условного Лида задачу по постоянному надзору за `chaotic-джунами`
- Тесты (с некоторыми ограничениями) выполняют функцию Доки по проекту (для разрабов!)
- Тесты с определенным процентом успеха не пускают кривой код в production (ВНЕЗАПНО №2)

### Что значит: у бизнеса есть на это деньги?

Вкратце - то самое и значит.
"Кто платит, тот и музыку заказывает", а если инвестор условного стартапа в душе не сечёт,
что и зачем мы там вошкаем как dev-team, то ему с высокой калокольни начхать на всё это "ржавение кода на дистанции".

Для условного инвестора важно ЗАРАБОТАТЬ (ВНЕЗАПНОЕ №3)

Проблемы начинаются, когда условный стартап перестает быть просто "очередным стартапом",
и начинает плавно переходить в категорию "продуктовой компании".

Причина? Привычка.

## Привычка?

Привычка.

Привычка просто имплементировать фичи, и закрывать 100500 тасок в секунду
(и плевать, что отвалилась регистрация - починим в моменте, раньше же так делали? Делали. Значит, и сейчас сделаем)

Привычка тестировать продукт силами самой dev-team или product-team
(в редких случаях - силами qa-team),
ведь "вы же сами это написали, и вы говорите, что не можете предугадать, как поведет себя продукт?
Я начинаю сомневаться в вашей компетентности" (и еще 1000 классных фраз от новоявленного CEO, CTO, whatever...)

### А потом - суп с котом (ШТА???)

Ладно-ладно, хватит кидаться тапками.
Торжественно клянусь, (_что замышляю только шалость_)
что ни одна животинка в ходе написания данного поста не пострадала.
(Комары - не в счёт)

Суммарно, круг замкнулся. Приложение стало крутым? Стало.

Приложение разрослось? Разрослось.

Так а тесты-то где??? А их нету, потому что мы работаем на бизнес (пам-пам),
а бизнесу нужно закрывать отчеты, нанимать персонал, и вот это вот все.

## А что в итоге?

По итогу (и по опыту прошлых компаний), если не было абстрактного "единорога",
который бы жестко и бескомпромиссно топил за тесты, то возможны 2 пути:

### "Андрюха, все \*\*\*ня. Давай по-новой"

Идея следующая: условного менеджера высшего звена (тут без сарказма: крутые ребята)
настолько задолбало, что ему из каждого утюга звенят:

- это плохо работает
- это сделать нельзя,
- этот крутой разраб, для появления которого был призван сам Сатана, ушел и плакал кровавыми слезами,
  как только увидел код

(**накидываем на вентилятор, накидываем, ну же, активнее**)

Что он принимает волевое решение: отложить какое-то количество денег на глобальную перепись кода.

Сразу скажу: мне повезло, и я когда-то попал именно на такой путь именно в такой компании,
а потому четко себе представляю, что там "за поворотом".

Чаще всего, данный путь выбирают, когда бизнес больше не может расти, ибо обслужиание и поддержание
кодовой базы продукта стоит дороже какого-то выставленного потолка.

Итог: пан или пропал.

- ИЛИ Все круто, и мы могучим рывком все сделали красиво
- ИЛИ Простите, п\*\*дец. Переписывание затянулось, бизнес теряет все больше, а конкуренты счастливы.

О развязке думайте сами.

### "Мягкая сила" в действии

Идея следующая: под мудрым надзором (_Гендальфа_) крутого Лида/Лидов,
начинаются точечные, но конкретные улучшения кода.

Что-то чистится, что-то выкидывается, что-то просто стабилизируется. Это нормально,
но сразу ремарка - найти лидов, которые могут это стабильно выносить и доносить до
бизнеса ценность - квест похлеще "я найду Цири и верну ее домой".

Обычно, это встраивается в процессы организации, и таким нехитрым финтом
еще сильнее замедляется "ржавение кода". Когда-то он все-равно произойдет,
но сейчас - мы тут ржавчину убрали, тут подкрасили, тут костылик подставили - круто,
теперь можно и фичу добавить.

Итог: эволюция/энволюция (тут как повезет).
Из практики, чаще всего начинают именно этот путь, но вот стабильно ему следуют - единицы.
